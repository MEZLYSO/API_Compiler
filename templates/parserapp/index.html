<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Parser Runner</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body { background: #f6f9fc; }
      .editor { font-family: Menlo, Monaco, monospace; font-size: 0.95rem; }
      pre.output { background:#0f1724; color:#e6eef8; padding:1rem; border-radius:6px; overflow:auto; }
    </style>
  </head>
  <body>


    <main class="container my-4">
      <div class="row">
        <div class="col-lg-7 mb-3">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title">Editor</h5>
              <textarea id="code" class="form-control editor" rows="14" placeholder="Escribe tu código aquí..."></textarea>
              <div class="mt-3 d-flex gap-2">
                <button id="run" class="btn btn-success">Run</button>
                <button id="clear" class="btn btn-outline-secondary">Clear</button>
                <button id="copy" class="btn btn-outline-primary">Copy Output</button>
                <div id="spinner" class="spinner-border text-primary ms-auto" role="status" style="display:none;">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-5 mb-3">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title">Output</h5>
              <pre id="output" class="output">&nbsp;</pre>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      const runBtn = document.getElementById('run');
      const clearBtn = document.getElementById('clear');
      const copyBtn = document.getElementById('copy');
      const codeEl = document.getElementById('code');
      const outputEl = document.getElementById('output');
      const spinner = document.getElementById('spinner');

      async function runCode(){
        const code = codeEl.value || '';
        spinner.style.display = 'inline-block';
        runBtn.disabled = true;
        try{
          const res = await fetch('/run/', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({text: code})
          });
          const data = await res.json();
          outputEl.textContent = data.code || '';
        }catch(err){
          outputEl.textContent = 'Network error: ' + err.message;
        }finally{
          spinner.style.display = 'none';
          runBtn.disabled = false;
        }
      }

      runBtn.addEventListener('click', runCode);
      clearBtn.addEventListener('click', ()=>{ codeEl.value = ''; outputEl.textContent = ''; });
      copyBtn.addEventListener('click', async ()=>{ await navigator.clipboard.writeText(outputEl.textContent || ''); });

      // keyboard shortcut: Ctrl+Enter to run
      codeEl.addEventListener('keydown', (e)=>{ if(e.ctrlKey && e.key === 'Enter'){ runCode(); } });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
